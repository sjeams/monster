{"version":3,"sources":["assets\\Script\\login\\http.js"],"names":["HttpHelper","cc","Class","Component","statics","properties","httpGet","url","callback","myGame","gameUi","onShowLockScreen","xhr","loader","getXMLHttpRequest","onreadystatechange","readyState","status","respone","responseText","rsp","JSON","parse","onHideLockScreen","withCredentials","open","setRequestHeader","gameManager","getToken","timeout","send","httpPost","params","stringify","httpPostLogin","account","password","str","window","btoa"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\r\n * Http 请求封装\r\n */\r\nconst HttpHelper = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    statics: {\r\n    },\r\n\r\n    properties: {\r\n\r\n    },\r\n\r\n    /**\r\n     * get请求\r\n     * @param {string} url \r\n     * @param {function} callback \r\n     */\r\n    httpGet(url, callback) {\r\n        cc.myGame.gameUi.onShowLockScreen();\r\n        let xhr = cc.loader.getXMLHttpRequest();\r\n        xhr.onreadystatechange = function () {\r\n            // cc.log(\"Get: readyState:\" + xhr.readyState + \" status:\" + xhr.status);\r\n            if (xhr.readyState === 4 && xhr.status == 200) {\r\n                let respone = xhr.responseText;\r\n                let rsp = JSON.parse(respone);\r\n                cc.myGame.gameUi.onHideLockScreen();\r\n                callback(rsp);\r\n            } else if (xhr.readyState === 4 && xhr.status == 401) {\r\n                cc.myGame.gameUi.onHideLockScreen();\r\n                callback({status:401});\r\n            } else {\r\n                //callback(-1);\r\n            }\r\n\r\n\r\n        };\r\n        xhr.withCredentials = true;\r\n        xhr.open('GET', url, true);\r\n\r\n        // if (cc.sys.isNative) {\r\n        xhr.setRequestHeader('Access-Control-Allow-Origin', '*');\r\n        xhr.setRequestHeader('Access-Control-Allow-Methods', 'GET, POST');\r\n        xhr.setRequestHeader('Access-Control-Allow-Headers', 'x-requested-with,content-type,authorization');\r\n        xhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n        xhr.setRequestHeader('Authorization', 'Bearer ' + cc.myGame.gameManager.getToken());\r\n        // xhr.setRequestHeader('Authorization', 'Bearer ' + \"\");\r\n        // }\r\n\r\n        // note: In Internet Explorer, the timeout property may be set only after calling the open()\r\n        // method and before calling the send() method.\r\n        xhr.timeout = 8000;// 8 seconds for timeout\r\n\r\n        xhr.send();\r\n    },\r\n\r\n    /**\r\n     * post请求\r\n     * @param {string} url \r\n     * @param {object} params \r\n     * @param {function} callback \r\n     */\r\n    httpPost(url, params, callback) {\r\n        cc.myGame.gameUi.onShowLockScreen();\r\n        let xhr = cc.loader.getXMLHttpRequest();\r\n        xhr.onreadystatechange = function () {\r\n            // cc.log('xhr.readyState=' + xhr.readyState + '  xhr.status=' + xhr.status);\r\n            if (xhr.readyState === 4 && xhr.status == 200) {\r\n                let respone = xhr.responseText;\r\n                let rsp = JSON.parse(respone);\r\n                cc.myGame.gameUi.onHideLockScreen();\r\n                callback(rsp);\r\n            } else {\r\n                callback(-1);\r\n            }\r\n        };\r\n        xhr.open('POST', url, true);\r\n        // if (cc.sys.isNative) {\r\n        xhr.setRequestHeader('Access-Control-Allow-Origin', '*');\r\n        xhr.setRequestHeader('Access-Control-Allow-Methods', 'GET, POST');\r\n        xhr.setRequestHeader('Access-Control-Allow-Headers', 'x-requested-with,content-type');\r\n        xhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n        xhr.setRequestHeader('Authorization', 'Bearer ' + cc.myGame.gameManager.getToken());\r\n        // }\r\n\r\n        // note: In Internet Explorer, the timeout property may be set only after calling the open()\r\n        // method and before calling the send() method.\r\n        xhr.timeout = 8000;// 8 seconds for timeout\r\n\r\n        xhr.send(JSON.stringify(params));\r\n    },\r\n\r\n    /**\r\n     * 登录专用\r\n     * @param {string} url \r\n     * @param {object} params \r\n     * @param {function} callback \r\n     * @param {string} account \r\n     * @param {string} password \r\n     */\r\n    httpPostLogin(url, params, callback, account, password) {\r\n        cc.myGame.gameUi.onShowLockScreen();\r\n        let xhr = cc.loader.getXMLHttpRequest();\r\n        xhr.onreadystatechange = function () {\r\n            // cc.log('xhr.readyState=' + xhr.readyState + '  xhr.status=' + xhr.status);\r\n            if (xhr.readyState === 4 && xhr.status == 200) {\r\n                let respone = xhr.responseText;\r\n                let rsp = JSON.parse(respone);\r\n                cc.myGame.gameUi.onHideLockScreen();\r\n                callback(rsp);\r\n            } else {\r\n                callback(-1);\r\n            }\r\n        };\r\n        xhr.open('POST', url, true);\r\n        xhr.setRequestHeader('Access-Control-Allow-Origin', '*');\r\n        xhr.setRequestHeader('Access-Control-Allow-Methods', 'GET, POST');\r\n        xhr.setRequestHeader('Access-Control-Allow-Headers', 'x-requested-with,content-type');\r\n        xhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n        let str = account + \"@\" + password;\r\n        xhr.setRequestHeader('Authorization', 'Basic' + ' ' + window.btoa(str));\r\n\r\n        xhr.timeout = 8000;// 8 seconds for timeout\r\n\r\n        xhr.send(JSON.stringify(params));\r\n\r\n    }\r\n});\r\n\r\nwindow.HttpHelper = new HttpHelper();"]}